<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - SaaS Hamburgueria</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        
        .login-card { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; position: relative; z-index: 1; }
        
        h1 { color: #D32F2F; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 30px; }
        
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; transition: 0.3s; }
        input:focus { border-color: #D32F2F; outline: none; }
        
        button { width: 100%; padding: 12px; background: #D32F2F; color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #b71c1c; }
        
        .error { color: red; font-size: 0.9rem; margin-bottom: 15px; display: none; background: #ffebee; padding: 10px; border-radius: 6px; }
        .footer-links { margin-top: 20px; font-size: 0.9rem; }
        .footer-links a { color: #D32F2F; text-decoration: none; }

        /* --- MODAL DE ESCOLHA DE PERFIL (FUNCION√ÅRIO) --- */
        .choice-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95); 
            z-index: 100; display: none; 
            align-items: center; justify-content: center; flex-direction: column;
            animation: fadeIn 0.3s;
        }
        .choice-overlay.visible { display: flex; }

        .choice-container { text-align: center; width: 100%; max-width: 350px; padding: 20px; }
        .choice-btn {
            display: flex; align-items: center; gap: 15px;
            background: white; border: 1px solid #ddd;
            padding: 20px; margin-bottom: 15px; border-radius: 12px;
            text-decoration: none; color: #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: 0.2s; font-weight: 600; font-size: 1.1rem;
        }
        .choice-btn:hover { transform: translateY(-3px); border-color: #D32F2F; color: #D32F2F; box-shadow: 0 8px 20px rgba(211, 47, 47, 0.15); }
        .choice-btn .material-icons-round { font-size: 2rem; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="login-card">
        <h1>üçî Acesso ao Sistema</h1>
        <p>Gerencie sua hamburgueria</p>
        
        <div id="error-msg" class="error"></div>

        <form id="login-form">
            <input type="email" id="email" placeholder="Seu e-mail" required>
            <input type="password" id="password" placeholder="Sua senha" required>
            <button type="submit" id="btn-login">Entrar</button>
        </form>
        
        <div class="footer-links">
            <a href="#" onclick="alert('Contate o suporte para redefini√ß√£o de senha.')">Esqueci minha senha</a>
        </div>
    </div>

    <!-- TELA DE ESCOLHA (Escondida por padr√£o) -->
    <div id="employee-choice" class="choice-overlay">
        <div class="choice-container">
            <h2 style="color: #333; margin-bottom: 10px;">Ol√°, <span id="user-name">Colaborador</span>! üëã</h2>
            <p style="color: #666; margin-bottom: 30px;">Onde voc√™ vai trabalhar agora?</p>

            <a href="#" id="btn-go-garcom" class="choice-btn">
                <span class="material-icons-round" style="color: #ff9800;">smartphone</span>
                App do Gar√ßom
            </a>
            <a href="#" id="btn-go-cozinha" class="choice-btn">
                <span class="material-icons-round" style="color: #4caf50;">kitchen</span>
                Tela da Cozinha
            </a>
            <a href="#" id="btn-go-caixa" class="choice-btn">
                <span class="material-icons-round" style="color: #2196f3;">point_of_sale</span>
                Caixa / PDV
            </a>
        </div>
    </div>

    <script type="module">
        import { SaasService } from './js/SaasService.js';
        const api = new SaasService();

        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('btn-login');
            const errorDiv = document.getElementById('error-msg');

            btn.innerText = "Verificando...";
            btn.disabled = true;
            errorDiv.style.display = 'none';

            try {
                // Realiza login e recebe dados do usu√°rio (role e restaurantId).
                const authData = await api.login(email, password);
                
                if (authData.role === 'super_admin') {
                    // 1. Super Admin -> Painel Master
                    window.location.href = 'master/index.html';
                } 
                else if (authData.role === 'owner') {
                    // 2. Dono -> Painel Administrativo
                    window.location.href = 'index.html'; 
                } 
                else if (authData.role === 'employee') {
                    // 3. Funcion√°rio -> Tela de Escolha
                    showEmployeeMenu(authData.restaurantId);
                }
                else {
                    throw new Error("Usu√°rio sem permiss√£o definida.");
                }

            } catch (error) {
                errorDiv.innerText = error.message;
                errorDiv.style.display = 'block';
                btn.innerText = "Entrar";
                btn.disabled = false;
            }
        });

        function showEmployeeMenu(restaurantId) {
            // Preenche os links com o ID correto da empresa
            const query = `?id=${restaurantId}`;
            document.getElementById('btn-go-garcom').href = `garcom.html${query}`;
            document.getElementById('btn-go-cozinha').href = `cozinha.html${query}`;
            document.getElementById('btn-go-caixa').href = `caixa.html${query}`;
            
            // Mostra o menu
            document.getElementById('employee-choice').classList.add('visible');
            
            // Esconde o card de login para ficar limpo
            document.querySelector('.login-card').style.display = 'none';
        }
    </script>
</body>
</html>